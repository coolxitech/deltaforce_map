import{d as e}from"./vendor-framework-DHKCbjaO.js";const t=e("settings",{state:()=>({type:"un",playerNum:0,mapId:0,loading:!0,playerSetting:{info:{name:!0,weapon:!0,health:!0,armor:!0,teammate:!0,angleViewLine:!0,storyHeight:!0,angle:!1,sightFollow:!1},color:{angleViewLine:"#ff0000"}},botSetting:{info:{display:!0,displayBoss:!0,name:!0,health:!0}},itemSetting:{info:{display:!0,name:!0,price:!0,filter:1e4},color:{1:"#ffffff",2:"#54ff9f",3:"#5feeff",4:"#b07eff",5:"#fff900",6:"#ff2802"}},boxSetting:{player:!0,bot:!0,color:{player:"#ff0000",bot:"#00ff00"}},otherSetting:{playerAvatarSize:30,rayLength:15,rayOpacity:.8,rayWidth:3,teammateSelectorSize:100},itemsInfo:null}),actions:{setItemsInfo(e){this.itemsInfo=e}},getters:{},persist:!0}),a=e=>{const t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substring(1).match(t);return null!=a?decodeURI(a[2]):null},o={13:"bt",12:"zj",11:"yy",10:"wm",5:"mxw",4:"ln",3:"myr",2:"sl",9:"wll",1:"g",6:"fy",8:"wl",7:"hl",0:"default"},r={2100654105:"wl",2100654106:"mxw",2100654107:"fy",2100654108:"ll",2100654109:"myr",2100654110:"hl",2100654115:"wll",2100654116:"g",2100654117:"sl",2100654118:"wm",2100654119:"zj",2100654120:"yy",2100654121:"bt"},i={bt:"四眼仔",zj:"张姐",yy:"老登",wm:"神秘静步男",mxw:"麦晓鼠",ln:"红温娜",myr:"牢大",sl:"教官",wll:"神秘堵桥男",g:"女医",fy:"疯医",wl:"威风的龙",hl:"花来!",default:"Boss",a:"机哥"};let s=null;const n={0:{name:"",offset:{x:0,y:0}},1:{name:"daba",offset:{x:357385,y:-769888}},2:{name:"cgxg",offset:{x:400062,y:-641652}},3:{name:"bks",offset:{x:378673,y:-448841}},4:{name:"htjd",offset:{x:668720,y:-452754}},5:{name:"cxjy",offset:{x:53272,y:-51971}}},l={name:"未知地图",offset:{x:0,y:0}};function y(e,t){return{x:e.x+t.x,y:e.y+t.y}}function f(e,t){const a=e?.M2,r=n[a]??l,{name:s,offset:f}=r;let m=[],c=[],p=[];e?.D2&&(m=e?.D2.map(e=>({isBot:e.a,position:y({x:e.b,y:e.c},f)}))),e?.I2&&(c=e?.I2.map(e=>{let a=t.find(t=>String(t.objectID)===e.b);return a?{id:e.b,price:a?.avgPrice,name:a.objectName,grade:a?.grade,position:y({x:e.f,y:e.g},f)}:{id:e.b,price:e.e,name:e.c,grade:e.d,position:y({x:e.f,y:e.g},f)}}));const h={name:s};return e?.P2&&(p=e.P2.map(e=>{const t=e.g??0,a=o[t]??`unknown_${t}`,r=a,s=i[a]??"";return{name:e.h||"未知玩家",isBot:1===e.c,isBoss:1===e.d,isCheater:1===e.b,role:t,roleName:1===e.c?"AI":r,roleAlias:s,weapon:e.i||"未知武器",health:e.n??100,helmet:e.j,armor:e.l,teamId:e.f,position:{...y({x:e.p,y:e.q},f),z:e.s,angle:e.r}}})),{boxes:m,items:c,map:h,players:p}}const m=async(e,t,a,o)=>{const n="delta"===e.type,l={name:{0:"",1:"bks",2:"cgxg",3:"htjd",4:"daba",5:"cxjy"}[e.m??0]??"未知地图"},y=s,f=new Map,m=new Map,c=new Map;if(n&&y&&(y.boxes.forEach(e=>f.set(`${e.position.x},${e.position.y}`,{...e})),y.items.forEach(e=>m.set(`${e.name}|${e.position.x},${e.position.y}|${e.grade}|${e.price}`,{...e})),y.players.forEach(e=>c.set(e.isBot?`bot_${e.position.x}_${e.position.y}`:e.name,{...e}))),e.a){if(n&&y)for(const[e,a]of c.entries())a.isBot&&c.delete(e);const t=Array.isArray(e.a)?e.a:e.a.u??[];(Array.isArray(e.a)?[]:(e.a.d??[]).map(e=>`bot_${e.cx}_${e.cy}`)).forEach(e=>c.delete(e)),t.forEach(e=>{if(0===e.d)return;const t={name:"AI人机",isBot:!0,isBoss:e.b,isCheater:!1,role:0,roleName:"AI",roleAlias:"人机",weapon:"",health:e.h??100,helmet:0,armor:0,teamId:0,position:{x:e.cx,y:e.cy,z:e.z??0}};c.set(`bot_${e.cx}_${e.cy}`,t)})}if(e.b){const t=Array.isArray(e.b)?e.b:e.b.u??[];(Array.isArray(e.b)?[]:(e.b.d??[]).map(e=>`${e.cx??e.x},${e.cy??e.y}`)).forEach(e=>f.delete(e)),t.forEach(e=>{const t=`${e.cx},${e.cy}`;f.set(t,{isBot:0===e.i,position:{x:e.cx,y:e.cy,z:e.z??0}})})}if(e.i){const a=Array.isArray(e.i)?e.i:e.i.u??[];(Array.isArray(e.i)?[]:(e.i.d??[]).map(e=>`${e.n}|${e.cx},${e.cy}|${e.v}|${e.p}`)).forEach(e=>m.delete(e)),a.forEach(e=>{const a=t.find(t=>t.objectName===e.n),o={id:a?.objectID?.toString(),name:a?.objectName??e.n,price:a?.avgPrice??e.p??0,grade:a?.grade??e.v??0,position:{x:e.cx,y:e.cy}},r=`${o.name}|${o.position.x},${o.position.y}|${o.grade}|${o.price}`;m.set(r,o)})}if(e.p){const t=Array.isArray(e.p)?e.p:e.p.u??[];(Array.isArray(e.p)?[]:(e.p.d??[]).map(e=>e.n)).forEach(e=>c.delete(e)),t.filter(e=>e&&e.n),t.forEach(e=>{const t=r[e.o]??"default",o={name:e.n||"未知玩家",isBot:!1,isBoss:!1,isCheater:a===e.t,role:e.o,roleName:t,roleAlias:i[t]??"",weapon:e.w||"未知武器",health:e.h??100,helmet:e.hl??0,helmetDurability:e.hh,armor:e.bl??0,armorDurability:e.bh,teamId:e.t??0,position:{x:e.cx,y:e.cy,z:e.z??0,angle:e.e}};c.set(e.n,o)})}const p={boxes:Array.from(f.values()),items:Array.from(m.values()),map:l,players:Array.from(c.values())};return s={boxes:p.boxes.map(e=>({...e,position:{...e.position}})),items:p.items.map(e=>({...e,position:{...e.position}})),players:p.players.map(e=>({...e,position:{...e.position}}))},p};export{t as S,m as a,f as c,a as g};
